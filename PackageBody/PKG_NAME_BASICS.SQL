SET DEFINE OFF
CREATE OR REPLACE PACKAGE BODY IMDB_STAGE.PKG_NAME_BASICS AS
  PROCEDURE SP_TRUNCATE_NAME_BASICS IS
  BEGIN
    EXECUTE IMMEDIATE 'TRUNCATE TABLE IMDB_STAGE.NAME_BASICS';
  END SP_TRUNCATE_NAME_BASICS;
  
  PROCEDURE SP_INSERT_NAME_BASICS IS
  BEGIN
  
    INSERT /*+ APPEND */ INTO IMDB_STAGE.NAME_BASICS (
        NCONST,
        PRIMARY_NAME,
        BIRTH_YEAR,
        DEATH_YEAR,
        PRIMARY_PROFESSION,
        KNOWN_FOR_TITLES)
      SELECT NBE.NCONST,
             NBE.PRIMARY_NAME,
             CASE 
              WHEN NBE.BIRTH_YEAR = '\N' 
              THEN 
                NULL
              ELSE
                TO_NUMBER(NBE.BIRTH_YEAR)
              END AS BIRTH_YEAR,
             CASE 
              WHEN NBE.DEATH_YEAR = '\N' 
              THEN 
                NULL
              ELSE
                TO_NUMBER(NBE.DEATH_YEAR)
              END AS DEATH_YEAR,
             NBE.PRIMARY_PROFESSION,
             NBE.KNOWN_FOR_TITLES
        FROM IMDB_STAGE.NAME_BASICS_EXT NBE
    ;

  END SP_INSERT_NAME_BASICS;
  
  PROCEDURE SP_LOAD_NAME_BASICS IS
  BEGIN
    SP_TRUNCATE_NAME_BASICS;
    SP_INSERT_NAME_BASICS;
  END SP_LOAD_NAME_BASICS;
  
END PKG_NAME_BASICS;
/
SHOW ERR
SET DEFINE ON 
