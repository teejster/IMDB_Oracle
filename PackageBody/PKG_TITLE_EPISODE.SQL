SET DEFINE OFF
CREATE OR REPLACE PACKAGE BODY IMDB_STAGE.PKG_TITLE_EPISODE AS
  PROCEDURE SP_TRUNCATE_TITLE_EPISODE IS
  BEGIN
    EXECUTE IMMEDIATE 'TRUNCATE TABLE IMDB_STAGE.TITLE_EPISODE';
  END SP_TRUNCATE_TITLE_EPISODE;
  
  PROCEDURE SP_INSERT_TITLE_EPISODE IS
  BEGIN
  
    INSERT /*+ APPEND */ INTO IMDB_STAGE.TITLE_EPISODE (
        TCONST,
        PARENT_TCONST,
        SEASON_NUMBER,
        EPISODE_NUMBER)
      SELECT TEE.TCONST,
             TEE.PARENT_TCONST,
             CASE 
              WHEN TEE.SEASON_NUMBER = '\N' 
              THEN 
                NULL
              ELSE
                TO_NUMBER(TEE.SEASON_NUMBER)
              END AS SEASON_NUMBER,
             CASE 
              WHEN TEE.EPISODE_NUMBER = '\N'
              THEN
                NULL
              ELSE
                TO_NUMBER(TEE.EPISODE_NUMBER)
              END AS EPISODE_NUMBER
        FROM IMDB_STAGE.TITLE_EPISODE_EXT TEE
    ;

  END SP_INSERT_TITLE_EPISODE;
  
  PROCEDURE SP_LOAD_TITLE_EPISODE IS
  BEGIN
    SP_TRUNCATE_TITLE_EPISODE;
    SP_INSERT_TITLE_EPISODE;
  END SP_LOAD_TITLE_EPISODE;
  
END PKG_TITLE_EPISODE;
/
SHOW ERR
SET DEFINE ON 
